# ‚öôÔ∏è Etapa 1: Build da aplica√ß√£o
FROM gradle:8.5-jdk17 AS builder

WORKDIR /app

# Copia todos os arquivos do projeto
COPY . .

# Executa o build (gera o .jar)
RUN gradle bootJar -x test

# üê≥ Etapa 2: Imagem final com JDK leve
FROM eclipse-temurin:17-jdk-alpine
ENV JAVA_TOOL_OPTIONS="-XX:+UseG1GC -XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0"

WORKDIR /app

# Copia o JAR gerado na etapa anterior
COPY --from=builder /app/build/libs/*.jar app.jar
# Define vari√°veis de ambiente padr√£o (override no Docker Run ou Render)
ENV SERVER_PORT=8086

# Exp√µe a porta configurada (Render usa isso)
EXPOSE ${SERVER_PORT}

# Comando para iniciar a aplica√ß√£o
ENTRYPOINT ["java", "-jar", "app.jar"]
